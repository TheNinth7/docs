---
sidebar_position: 5
---

import Drawio from '@theme/Drawio'
import diagrams from '!!raw-loader!./img/diagrams.drawio';

# Available charging power

---
**What you'll learn**: how available surplus is calculated in `Solar` and `Min+Solar` mode.

---

In the `Solar` and `Min+Solar` mode, the system constantly monitors the `available charging power` (surplus), and [starts](./startstop) the charging process if it exceeds the [`minimum charging power`](./minmaxphases) required for the vehicle and charger. If the `available charging power` changes, evcc adapts the charging power or [stops](./startstop) charging accordingly. 

The `Min+Solar` mode adapts the charging power in the same fashion, but continuously charges the EV with at least `minimum charging power` instead of starting or stopping based on surplus.

For calulating the `available charging power`, an electric meter measuring the power on your grid connection point (grid meter) is important. Power generated by the photovoltaic system can also be measured and displayed, but has no effect on the function, [except if no grid meter is available](./meters#i-have-a-solar-installation-but-i-dont-have-a-readable-grid-connection-meter---can-i-still-use-evcc). Evcc also considers power consumption by batteries and other devices, which may be diverted to vehicle charging depending on your priorities. 

The `available charging power` is calculated in [intervals](./timing-interval). If you have [multiple loadpoints](./timing-multiple-loadpoints), at each `interval` only one will be calculated and adjusted. This way each `loadpoint` represents its own independent control circuit. `Available charging power` for one `loadpoint` also includes the `charging power` used by `loadpoints` with lower priority, enabling power to be diverted from them.

## Inputs and configuration

Let's start with a closer look at the inputs that are used in the calculation of `available charging power`.

For power values in Watt, the tables below will indicate the meaning of positive and negative values. Generally, for `grid power`, `PV power` and `battery power` as suppliers, positive means power being supplied and negative means power being feed into grid or battery. For `charging power` and `aux power` as consumers, positive means power consumed. In line with `charging power` also the calculated values for `minimum charging power`, `maximum charging power` and `available charging power` are positive.

|Input|Description|Positive|Negative|Aggregation|
|-----|-----------|--------|--------|-----------|
|[Grid power](../reference/configuration/site/#metersgrid)&nbsp;(W)|The most important factor in the calculation, showing available surplus that is fed into the grid.|Power drawn from the grid|Power is feed to the grid|-|
|[Battery power](../reference/configuration/site/#metersbattery)&nbsp;(W)|With power readings from batteries that are also charged with surplus, evcc can prioritize vehicle charging. It does that by increasing the charging power of the vehicle, practically forcing the battery to reduce or stop charging.|Power is drawn from the battery|Power is charged into the battery|Sum of all batteries|
|[Battery state-of-charge](../reference/configuration/site/#metersbattery)&nbsp;(%)|Enables prioritization of vehicle charging depending on the charge level of the batteries (see above).|-|-|Average of all batteries, weighted by capacity|
|[Aux power](../reference/configuration/site/#metersaux)&nbsp;(W)|Represents power used by other surplus-operated devices that should be diverted to vehicle charging.|Power available for vehicle charging|Power that should be left for the aux device|Sum of all aux devices|
|[PV power](../reference/configuration/site/#meterspv)&nbsp;(W)|The output of your PV system(s) can also be measured, mostly for display purposes. Only if [grid power cannot be measured](./meters#i-have-a-solar-installation-but-i-dont-have-a-readable-grid-connection-meter---can-i-still-use-evcc), PV power will be used instead and you can set `residualPower` (see below) to a constant value for assumed house consumption to approximate surplus|Power that is produced by the PV system|-|Sum of all PV systems|
|[Charging power](../devices/chargers)&nbsp;(W)|The actual charging power consumed by the charger is also measured. If the charger itself does not provide this measurement, [a separate meter](../reference/configuration/loadpoints#meter) can be configured for the `loadpoint` representing the charger. If that is not available as well, then instead the power last set by evcc will be used.|The amount of power the vehicle(s) is/are currently charged with|-|If multiple `loadpoints`, `charging power` also includes `loadpoints` with lower `priority`.|

Additionally, the following other configuration parameters influence the calculation of `available charging power`:

|Parameter|Description|Positive|Negative|
|---------|-----------|--------|--------|
|[`site.residualPower`](../reference/configuration/site/#residualpower)&nbsp;(W)|Is incorporated in the `available charging power` to set the target operating level for `grid power`. In other words, the system will aim to keep `grid power` at the value set for `residualPower`.|Power vehicle charging should leave for grid or battery|Power vehicle charging may draw from the grid or battery|
|[`site.prioritySoc`](../reference/configuration/site/#prioritysoc)&nbsp;(%)|If the `battery state-of-charge` is above this limit, vehicle charging will be prioritized.|-|-|
|[`loadpoint.priority`](../reference/configuration/loadpoints/#priority)&nbsp;(Int)|Defines priorities between multiple chargers. The higher the number, the higher the priority.|-|-|
|[`site.maxGridSupplyWhileBatteryCharging`](../reference/configuration/site/#maxgridsupplywhilebatterycharging)&nbsp;(W)|Deals with situations where vehicle charging is prioritized over battery charging but measured battery power may not be fully accessible for vehicle charging.<br/><br/>With an inverter with directly connected DC battery, the DC capacity of the panels may exceed the inverter’s AC output capacity, additional surplus can then only be charged into the battery. In this case, evcc would still include the battery power into available charging power, but the power then has to be drawn from the grid because of the bottle neck of the inverter’s AC output. `maxGridSupplyWhileBatteryCharging` was introduced to help with that: if consumed `grid power` exceeds that limit, then `battery power` will be excluded from `available charging power`, even if `battery state-of-charge` is higher than `prioritySoc`.|-|-|

Next, we'll learn how `available charging power` is calculated under different circumstances.

## Calculation of available charging power

`Available charging power` is a positive value indicating how much power in Watt is available for charging the vehicle connected to a `loadpoint`.

The following diagrams shows how the variables listed above are factored into the calculation of `available charging power`. The formulas are not necessarily those programmed into evcc, but rather provide a mathematical model that helps understanding how the software works.

### Based on grid power

Without a battery, the following formula shows how 'available charging power' is calculated with data from a grid meter:

<Drawio content={diagrams} zoom={0.7} pageId={"acp"} toolbar={"lightbox"} /><br/>

### With a battery

If you have a battery for which you can measure `battery power` and `battery state-of-charge`, then depending on the charge level and configured `prioritySoc` the `battery power` will be included in the `available charging power`. That increases the power going to the vehicle, practically forcing the battery to reduce or stop charging.

 Note that in combination with battery it is possible but not recommended to set a negative `residualPower`. With a battery, a negative `residualPower` will lead to power be drawn from the battery for vehicle charging, regardless of configured priorities.

<Drawio content={diagrams} zoom={0.7} pageId={"acp-battery"} toolbar={"lightbox"} /><br/>

In the next chapter we'll have a look at how `minimum charging power` and `maximum charging power` are calculated.

### With a battery and maxGridSupplyWhileBatteryCharging

As outlined above, `maxGridSupplyWhileBatteryCharging` introduces another condition for including battery power into the `available charging power`, to deal with situations where power that is fed into the battery cannot be diverted to vehicle charging due to limits in the interface between the battery inverter and rest of the system.

If `maxGridSupplyWhileBatteryCharging` is set, then `battery power` is included only if both `grid power` is below that set limit and `battery state-of-charge` is higher than `prioritySoc`.

<Drawio content={diagrams} zoom={0.7} pageId={"acp-battery-maxsupply"} toolbar={"lightbox"} /><br/>

### Based on PV power

If you have [no grid meter](./meters#i-have-a-solar-installation-but-i-dont-have-a-readable-grid-connection-meter---can-i-still-use-evcc), you can use PV power instead. House consumption is not known in this case, but as described above, you can use a positive value for `residualPower` to assume a constant for house consumption. If no grid meter is configured, the system will replace `charging power` and `grid power` with `PV power`:

<Drawio content={diagrams} zoom={0.7} pageId={"acp-pv"} toolbar={"lightbox"} /><br/>
